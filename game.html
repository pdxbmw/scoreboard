<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Fredoka', sans-serif; background: #f8f9fa; margin: 0; padding: 0; }
        
        /* ESPN-inspired Header */
        .game-header {
            background: #333; color: white; padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;
        }
        .back-btn { 
            background: rgba(255,255,255,0.2); color: white; border: none; 
            padding: 8px 16px; border-radius: 20px; font-weight: bold; cursor: pointer;
            text-decoration: none; font-size: 0.9rem; transition: background 0.3s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.3); }
        .game-title { font-size: 1.5rem; font-weight: 600; }
        .live-badge {
            background: #ff4444; color: white; padding: 4px 12px; 
            border-radius: 12px; font-size: 0.8rem; font-weight: bold;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        /* Main Container */
        .main-container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        
        /* Score Section */
        .score-section {
            background: white; border-radius: 12px; padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px;
        }
        .score-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #e8e8e8;
        }
        .game-info { font-size: 0.9rem; color: #666; }
        .status-display {
            background: #f0f0f0; padding: 8px 16px; border-radius: 20px; 
            font-weight: 600; font-size: 0.9rem;
        }
        .status-display.live { background: #ff4444; color: white; }
        
        .teams-score {
            display: grid; grid-template-columns: 1fr auto 1fr; gap: 30px; align-items: center;
        }
        .team-score-card {
            text-align: center; cursor: pointer; transition: transform 0.2s;
        }
        .team-score-card:hover { transform: translateY(-2px); }
        .team-label {
            font-size: 0.7rem; font-weight: bold; color: #666; 
            margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px;
        }
        .team-logo { width: 80px; height: 80px; margin-bottom: 10px; }
        .team-name { font-size: 1.1rem; font-weight: 600; margin-bottom: 5px; }
        .team-record { font-size: 0.8rem; color: #888; margin-bottom: 10px; }
        .team-score { 
            font-size: 2.5rem; 
            font-weight: bold; 
            color: #333; 
            line-height: 1;
            margin: 10px 0;
        }
        .team-score.live { color: #000; }
        
        .score-divider {
            font-size: 1.5rem; font-weight: bold; color: #666;
        }
        
        /* Team Stats Side by Side */
        .team-stats-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;
        }
        .team-stats-section {
            display: flex; flex-direction: column; gap: 15px;
        }
        .stats-card {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .stats-header {
            font-size: 1.1rem; font-weight: 600; margin-bottom: 15px;
            padding-bottom: 10px; border-bottom: 1px solid #e8e8e8;
        }
        .stat-row {
            display: flex; justify-content: space-between; padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-label { color: #666; font-size: 0.9rem; }
        .stat-value { font-weight: 600; font-size: 0.9rem; }
        
        /* Play by Play */
        .play-by-play {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .play-item {
            display: flex; align-items: center; padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .play-item:last-child { border-bottom: none; }
        .play-time {
            font-weight: 600; color: #666; width: 60px; font-size: 0.9rem;
        }
        .play-text { flex: 1; margin-left: 15px; font-size: 0.9rem; line-height: 1.4; }
        .play-score {
            font-weight: bold; color: #333; width: 50px; text-align: right;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
            .teams-score { grid-template-columns: 1fr; gap: 20px; text-align: center; }
            .score-divider { display: none; }
            .header-content { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>

    <div class="game-header">
        <div class="header-content">
            <a href="index.html" class="back-btn">‚Üê Back</a>
            <div class="game-title" id="gameTitle">Game Details</div>
            <div class="live-badge" id="liveIndicator" style="display: none;">LIVE</div>
        </div>
    </div>

    <div class="main-container">
        <!-- Score Section -->
        <div class="score-section">
            <div class="score-header">
                <div class="game-info">
                    <div id="gameLeague">NBA</div>
                    <div id="gameDate">Loading...</div>
                </div>
                <div class="status-display" id="gameStatus">
                    <span id="statusText">Loading...</span>
                </div>
            </div>
            
            <div class="teams-score">
                <div class="team-score-card" id="awayTeam" onclick="goToTeam('away')">
                    <div class="team-label">AWAY</div>
                    <img id="awayLogo" src="" alt="Away Team" class="team-logo">
                    <div class="team-name" id="awayName">Away Team</div>
                    <div class="team-record" id="awayRecord">0-0</div>
                    <div class="team-score" id="awayScore">0</div>
                </div>
                
                <div class="score-divider">@</div>
                
                <div class="team-score-card" id="homeTeam" onclick="goToTeam('home')">
                    <div class="team-label">HOME</div>
                    <img id="homeLogo" src="" alt="Home Team" class="team-logo">
                    <div class="team-name" id="homeName">Home Team</div>
                    <div class="team-record" id="homeRecord">0-0</div>
                    <div class="team-score" id="homeScore">0</div>
                </div>
            </div>
        </div>
        
        <!-- Team Stats Side by Side -->
        <div class="team-stats-container">
            <div class="team-stats-section">
                <div class="stats-card">
                    <div class="stats-header">Team Leaders</div>
                    <div id="awayTeamLeaders">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header">Game Statistics</div>
                    <div id="awayGameStats">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header">Advanced Stats</div>
                    <div id="awayAdvancedStats">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header">Team Stats</div>
                    <div id="awayTeamStats">Loading...</div>
                </div>
            </div>
            
            <div class="team-stats-section">
                <div class="stats-card">
                    <div class="stats-header">Team Leaders</div>
                    <div id="homeTeamLeaders">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header">Game Statistics</div>
                    <div id="homeGameStats">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header">Advanced Stats</div>
                    <div id="homeAdvancedStats">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header">Team Stats</div>
                    <div id="homeTeamStats">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Parse URL params
        const params = new URLSearchParams(window.location.search);
        const GAME_ID = params.get('id');
        const HOME_COLOR = decodeURIComponent(params.get('homeColor') || '#333333');
        const AWAY_COLOR = decodeURIComponent(params.get('awayColor') || '#333333');

        let updateInterval;
let lastScores = { home: 0, away: 0 };

        async function loadGameData() {
            if (!GAME_ID) {
                document.getElementById('gameTitle').innerText = 'Game Not Found';
                return;
            }

            try {
                console.log('üîÑ Fetching detailed game data from ESPN API');
                let gameData = null;
                
                // First try to get data from ESPN API
                try {
                    const gameUrl = `https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard`;
                    console.log('Fetching from URL:', gameUrl);
                    
                    const gameRes = await fetch(gameUrl);
                    const gameDataResponse = await gameRes.json();
                    
                    console.log('Game data response events count:', gameDataResponse.events?.length || 0);
                    console.log('Looking for game ID:', GAME_ID);
                    
                    // Find our game in the data
                    for (const event of gameDataResponse.events) {
                        console.log('Checking event ID:', event.id);
                        if (event.id === GAME_ID) {
                            const comp = event.competitions[0];
                            const status = comp.status?.type?.shortDetail || '';
                            const home = comp.competitors[0];
                            const away = comp.competitors[1];
                            
                            console.log('Found game - League from ESPN:', event.leagues?.[0]?.name);
                            
                            gameData = {
                                id: event.id,
                                league: event.leagues?.[0]?.name || 'NBA',
                                league_key: 'nba',
                                sport: 'basketball',
                                league_slug: 'nba',
                                date_label: new Date(event.date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' }),
                                status: status,
                                completed: comp.status?.type?.completed || false,
                                fullCompetition: comp,
                                away: {
                                    name: away.team.displayName,
                                    logo: away.team.logos?.[0]?.href || away.team.logo || '',
                                    color: AWAY_COLOR || "#" + (away.team.color || '333333'),
                                    record: away.records?.[0]?.summary || '0-0',
                                    score: away.score || '0'
                                },
                                home: {
                                    name: home.team.displayName,
                                    logo: home.team.logos?.[0]?.href || home.team.logo || '',
                                    color: HOME_COLOR || "#" + (home.team.color || '333333'),
                                    record: home.records?.[0]?.summary || '0-0',
                                    score: home.score || '0'
                                }
                            };
                            console.log('üî¥ Detailed game data fetched from ESPN API');
                            console.log('üî¥ Game data:', gameData);
                            break;
                        }
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è ESPN API failed, trying scraped data:', e);
                }
                
                // If ESPN didn't have the game, try to get it from scraped data
                if (!gameData) {
                    console.log('üîÑ Game not found in ESPN API, trying scraped data');
                    try {
                        const scrapedRes = await fetch('data/scores.json');
                        const scrapedData = await scrapedRes.json();
                        
                        // Search through all dates in scraped data
                        for (const dateKey in scrapedData) {
                            const games = scrapedData[dateKey];
                            if (Array.isArray(games)) {
                                const foundGame = games.find(g => g.id === GAME_ID);
                                if (foundGame) {
                                    console.log('‚úÖ Found game in scraped data:', foundGame);
                                    gameData = {
                                        ...foundGame,
                                        league: foundGame.league || 'NBA',
                                        date_label: foundGame.date_label || new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' })
                                    };
                                    break;
                                }
                            }
                        }
                    } catch (e) {
                        console.log('‚ö†Ô∏è Could not load scraped data:', e);
                    }
                }

                if (gameData) {
                    // Check if scores changed
                    const currentHomeScore = parseInt(gameData.home.score);
                    const currentAwayScore = parseInt(gameData.away.score);
                    
                    if (lastScores.home !== currentHomeScore || lastScores.away !== currentAwayScore) {
                        console.log(`üìä SCORES CHANGED: ${lastScores.away}-${lastScores.home} ‚Üí ${currentAwayScore}-${currentHomeScore}`);
                        lastScores = { home: currentHomeScore, away: currentAwayScore };
                    } else {
                        console.log(`üìä Scores unchanged: ${currentAwayScore}-${currentHomeScore}`);
                    }
                    
                    updateGameDisplay(gameData);
                    
                    // Set up live updates only for live ESPN games
                    const isLiveGame = !gameData.completed && (
                        gameData.status.includes('Q1') || gameData.status.includes('Q2') || 
                        gameData.status.includes('Q3') || gameData.status.includes('Q4') ||
                        gameData.status.includes('Halftime') || gameData.status.includes('OT') ||
                        /\d+:\d+\s*-\s*\d+(st|nd|rd|th)/.test(gameData.status)
                    );
                    
                    if (isLiveGame) {
                        startLiveUpdates();
                    }
                } else {
                    document.getElementById('gameTitle').innerText = 'Game Not Found';
                }
            } catch (e) {
                console.error('Error loading game:', e);
                document.getElementById('gameTitle').innerText = 'Error Loading Game';
            }
        }

        function updateGameDisplay(game) {
            console.log('üé® updateGameDisplay called with game:', game);
            
            // Check if all required elements exist
            const requiredElements = [
                'gameTitle', 'gameLeague', 'gameDate', 'awayLogo', 'awayName', 
                'awayRecord', 'awayScore', 'homeLogo', 'homeName', 'homeRecord', 'homeScore',
                'gameStatus', 'statusText', 'liveIndicator'
            ];
            
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`üîç Element ${id}:`, element ? '‚úÖ Found' : '‚ùå Missing');
            });
            
            // Update header
            const gameTitle = document.getElementById('gameTitle');
            if (gameTitle) gameTitle.innerText = `${game.away.name} @ ${game.home.name}`;
            
            // Update team information
            const awayLogo = document.getElementById('awayLogo');
            const homeLogo = document.getElementById('homeLogo');
            const awayName = document.getElementById('awayName');
            const homeName = document.getElementById('homeName');
            const awayRecord = document.getElementById('awayRecord');
            const homeRecord = document.getElementById('homeRecord');
            const awayScore = document.getElementById('awayScore');
            const homeScore = document.getElementById('homeScore');
            
            if (awayLogo) {
                awayLogo.src = game.away.logo;
                awayLogo.setAttribute('data-team-id', game.away.id);
                awayLogo.setAttribute('data-team-color', AWAY_COLOR);
                console.log('üî¥ Away team:', game.away.name, 'Color:', AWAY_COLOR);
            }
            if (awayName) awayName.innerText = game.away.name;
            if (awayRecord) awayRecord.innerText = game.away.record;
            if (awayScore) {
                awayScore.innerText = game.away.score;
                console.log('üî¥ Set away score to:', game.away.score);
            } else {
                console.error('‚ùå Away score element not found!');
            }
            
            if (homeLogo) {
                homeLogo.src = game.home.logo;
                homeLogo.setAttribute('data-team-id', game.home.id);
                homeLogo.setAttribute('data-team-color', HOME_COLOR);
                console.log('üî¥ Home team:', game.home.name, 'Color:', HOME_COLOR);
            }
            if (homeName) homeName.innerText = game.home.name;
            if (homeRecord) homeRecord.innerText = game.home.record;
            if (homeScore) {
                homeScore.innerText = game.home.score;
                console.log('üî¥ Set home score to:', game.home.score);
            } else {
                console.error('‚ùå Home score element not found!');
            }
            
            // Update status
            const statusEl = document.getElementById('gameStatus');
            const statusText = document.getElementById('statusText');
            const liveIndicator = document.getElementById('liveIndicator');
            
            // Only apply live styling for actually live games
            const isLiveGame = !game.completed && (
                game.status.includes('Q1') || game.status.includes('Q2') || 
                game.status.includes('Q3') || game.status.includes('Q4') ||
                game.status.includes('Halftime') || game.status.includes('OT') ||
                /\d+:\d+\s*-\s*\d+(st|nd|rd|th)/.test(game.status)
            );
            
            // Format status with red time for live games
            let displayStatus = game.status;
            if (isLiveGame && /\d+:\d+\s*-\s*\d+(st|nd|rd|th)/.test(game.status)) {
                const timeMatch = game.status.match(/(\d+:\d+)/);
                const quarterNum = game.status.match(/(\d+)(?:st|nd|rd|th)/);
                if (timeMatch && quarterNum) {
                    displayStatus = `Q${quarterNum[1]} <span class="live-text white">${timeMatch[1]}</span>`;
                }
            }
            
            console.log('Game status:', game.status);
            console.log('Is completed:', game.completed);
            console.log('Is live game:', isLiveGame);
            
            if (statusText) statusText.innerHTML = displayStatus;
            
            if (isLiveGame) {
                if (statusEl) statusEl.className = 'status-display live';
                if (liveIndicator) liveIndicator.style.display = 'block';
                if (awayScore) awayScore.classList.add('live');
                if (homeScore) homeScore.classList.add('live');
                console.log('üî¥ Game is LIVE - showing live indicator');
            } else if (game.completed) {
                if (statusEl) statusEl.className = 'status-display';
                if (liveIndicator) liveIndicator.style.display = 'none';
                if (awayScore) awayScore.classList.remove('live');
                if (homeScore) homeScore.classList.remove('live');
                console.log('Game is completed');
            } else {
                if (statusEl) statusEl.className = 'status-display';
                if (liveIndicator) liveIndicator.style.display = 'none';
                if (awayScore) awayScore.classList.remove('live');
                if (homeScore) homeScore.classList.remove('live');
                console.log('Game is scheduled');
            }
            
            // Update all team-specific stats sections
            updateAwayTeamLeaders(game);
            updateHomeTeamLeaders(game);
            updateAwayGameStats(game);
            updateHomeGameStats(game);
            updateAwayAdvancedStats(game);
            updateHomeAdvancedStats(game);
            updateAwayTeamStats(game);
            updateHomeTeamStats(game);
            
            // Update header colors with team colors
            console.log('üé® About to call updateHeaderColors()...');
            updateHeaderColors();
            console.log('üé® updateHeaderColors() call completed!');
        }
        
        function updateAwayTeamLeaders(game) {
            const leadersContainer = document.getElementById('awayTeamLeaders');
            if (!leadersContainer) return;
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const awayCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'away');
                
                if (awayCompetitor && awayCompetitor.leaders) {
                    let html = '';
                    awayCompetitor.leaders.forEach(leaderCategory => {
                        if (leaderCategory.leaders && leaderCategory.leaders.length > 0) {
                            const leader = leaderCategory.leaders[0];
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${leader.athlete?.displayName || 'Unknown'}</span>
                                    <span class="stat-value">${leader.displayValue} ${leaderCategory.displayName}</span>
                                </div>
                            `;
                        }
                    });
                    
                    leadersContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
                } else {
                    leadersContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
                }
            } else {
                leadersContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
            }
        }
        
        function updateHomeTeamLeaders(game) {
            const leadersContainer = document.getElementById('homeTeamLeaders');
            if (!leadersContainer) return;
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const homeCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'home');
                
                if (homeCompetitor && homeCompetitor.leaders) {
                    let html = '';
                    homeCompetitor.leaders.forEach(leaderCategory => {
                        if (leaderCategory.leaders && leaderCategory.leaders.length > 0) {
                            const leader = leaderCategory.leaders[0];
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${leader.athlete?.displayName || 'Unknown'}</span>
                                    <span class="stat-value">${leader.displayValue} ${leaderCategory.displayName}</span>
                                </div>
                            `;
                        }
                    });
                    
                    leadersContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
                } else {
                    leadersContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
                }
            } else {
                leadersContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
            }
        }
        
        function updateAwayGameStats(game) {
            const statsContainer = document.getElementById('awayGameStats');
            if (!statsContainer) return;
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const awayCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'away');
                
                if (awayCompetitor && awayCompetitor.statistics) {
                    let html = '';
                    const keyStats = ['fieldGoalPct', 'threePointPct', 'freeThrowPct', 'rebounds', 'assists'];
                    
                    keyStats.forEach(statName => {
                        const stat = awayCompetitor.statistics.find(s => s.name === statName);
                        if (stat) {
                            let label = statName;
                            if (statName === 'fieldGoalPct') label = 'Field Goal %';
                            else if (statName === 'threePointPct') label = '3-Point %';
                            else if (statName === 'freeThrowPct') label = 'Free Throw %';
                            else if (statName === 'rebounds') label = 'Total Rebounds';
                            else if (statName === 'assists') label = 'Assists';
                            
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${label}</span>
                                    <span class="stat-value">${stat.displayValue}</span>
                                </div>
                            `;
                        }
                    });
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
            }
        }
        
        function updateHomeGameStats(game) {
            const statsContainer = document.getElementById('homeGameStats');
            if (!statsContainer) return;
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const homeCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'home');
                
                if (homeCompetitor && homeCompetitor.statistics) {
                    let html = '';
                    const keyStats = ['fieldGoalPct', 'threePointPct', 'freeThrowPct', 'rebounds', 'assists'];
                    
                    keyStats.forEach(statName => {
                        const stat = homeCompetitor.statistics.find(s => s.name === statName);
                        if (stat) {
                            let label = statName;
                            if (statName === 'fieldGoalPct') label = 'Field Goal %';
                            else if (statName === 'threePointPct') label = '3-Point %';
                            else if (statName === 'freeThrowPct') label = 'Free Throw %';
                            else if (statName === 'rebounds') label = 'Total Rebounds';
                            else if (statName === 'assists') label = 'Assists';
                            
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${label}</span>
                                    <span class="stat-value">${stat.displayValue}</span>
                                </div>
                            `;
                        }
                    });
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
            }
        }
        
        function updateAwayAdvancedStats(game) {
            const statsContainer = document.getElementById('awayAdvancedStats');
            if (!statsContainer) return;
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const awayCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'away');
                
                if (awayCompetitor && awayCompetitor.statistics) {
                    let html = '';
                    const advancedStats = ['fieldGoalsAttempted', 'fieldGoalsMade', 'threePointFieldGoalsAttempted', 'threePointFieldGoalsMade', 'freeThrowsAttempted', 'freeThrowsMade'];
                    
                    advancedStats.forEach(statName => {
                        const stat = awayCompetitor.statistics.find(s => s.name === statName);
                        if (stat) {
                            let label = statName;
                            if (statName === 'fieldGoalsAttempted') label = 'FG Attempts';
                            else if (statName === 'fieldGoalsMade') label = 'FG Made';
                            else if (statName === 'threePointFieldGoalsAttempted') label = '3PT Attempts';
                            else if (statName === 'threePointFieldGoalsMade') label = '3PT Made';
                            else if (statName === 'freeThrowsAttempted') label = 'FT Attempts';
                            else if (statName === 'freeThrowsMade') label = 'FT Made';
                            
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${label}</span>
                                    <span class="stat-value">${stat.displayValue}</span>
                                </div>
                            `;
                        }
                    });
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
            }
        }
        
        function updateHomeAdvancedStats(game) {
            const statsContainer = document.getElementById('homeAdvancedStats');
            if (!statsContainer) return;
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const homeCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'home');
                
                if (homeCompetitor && homeCompetitor.statistics) {
                    let html = '';
                    const advancedStats = ['fieldGoalsAttempted', 'fieldGoalsMade', 'threePointFieldGoalsAttempted', 'threePointFieldGoalsMade', 'freeThrowsAttempted', 'freeThrowsMade'];
                    
                    advancedStats.forEach(statName => {
                        const stat = homeCompetitor.statistics.find(s => s.name === statName);
                        if (stat) {
                            let label = statName;
                            if (statName === 'fieldGoalsAttempted') label = 'FG Attempts';
                            else if (statName === 'fieldGoalsMade') label = 'FG Made';
                            else if (statName === 'threePointFieldGoalsAttempted') label = '3PT Attempts';
                            else if (statName === 'threePointFieldGoalsMade') label = '3PT Made';
                            else if (statName === 'freeThrowsAttempted') label = 'FT Attempts';
                            else if (statName === 'freeThrowsMade') label = 'FT Made';
                            
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${label}</span>
                                    <span class="stat-value">${stat.displayValue}</span>
                                </div>
                            `;
                        }
                    });
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
            }
        }
        
        function updateAwayTeamStats(game) {
            const statsContainer = document.getElementById('awayTeamStats');
            if (!statsContainer) return;
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const awayCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'away');
                
                if (awayCompetitor) {
                    let html = '';
                    
                    // Add team record
                    if (awayCompetitor.records && awayCompetitor.records.length > 0) {
                        html += `
                            <div class="stat-row">
                                <span class="stat-label">Record</span>
                                <span class="stat-value">${awayCompetitor.records[0].summary}</span>
                            </div>
                        `;
                    }
                    
                    // Add quarter scores
                    if (awayCompetitor.linescores && awayCompetitor.linescores.length > 0) {
                        const quarterScores = awayCompetitor.linescores.map(s => s.displayValue).join(', ');
                        html += `
                            <div class="stat-row">
                                <span class="stat-label">Quarter Scores</span>
                                <span class="stat-value">${quarterScores}</span>
                            </div>
                        `;
                    }
                    
                    // Add winner indicator
                    html += `
                        <div class="stat-row">
                            <span class="stat-label">Winner</span>
                            <span class="stat-value">${awayCompetitor.winner ? '‚úì' : ''}</span>
                        </div>
                    `;
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
            }
        }
        
        function updateHomeTeamStats(game) {
            const statsContainer = document.getElementById('homeTeamStats');
            if (!statsContainer) return;
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const homeCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'home');
                
                if (homeCompetitor) {
                    let html = '';
                    
                    // Add team record
                    if (homeCompetitor.records && homeCompetitor.records.length > 0) {
                        html += `
                            <div class="stat-row">
                                <span class="stat-label">Record</span>
                                <span class="stat-value">${homeCompetitor.records[0].summary}</span>
                            </div>
                        `;
                    }
                    
                    // Add quarter scores
                    if (homeCompetitor.linescores && homeCompetitor.linescores.length > 0) {
                        const quarterScores = homeCompetitor.linescores.map(s => s.displayValue).join(', ');
                        html += `
                            <div class="stat-row">
                                <span class="stat-label">Quarter Scores</span>
                                <span class="stat-value">${quarterScores}</span>
                            </div>
                        `;
                    }
                    
                    // Add winner indicator
                    html += `
                        <div class="stat-row">
                            <span class="stat-label">Winner</span>
                            <span class="stat-value">${homeCompetitor.winner ? '‚úì' : ''}</span>
                        </div>
                    `;
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
            }
        }

        function startLiveUpdates() {
            const leadersContainer = document.getElementById('teamLeaders');
            if (!leadersContainer) return;
            
            // Mock data for now - we'll extract this from ESPN API later
            const leaders = [
                { team: 'away', name: 'Ja Morant', stat: 'Points', value: '28' },
                { team: 'home', name: 'Damian Lillard', stat: 'Points', value: '31' },
                { team: 'away', name: 'Jaren Jackson Jr.', stat: 'Rebounds', value: '12' },
                { team: 'home', name: 'Jusuf Nurkiƒá', stat: 'Rebounds', value: '14' },
                { team: 'away', name: 'Tyus Jones', stat: 'Assists', value: '8' },
                { team: 'home', name: 'Anfernee Simons', stat: 'Assists', value: '9' }
            ];
            
            let html = '';
            leaders.forEach(leader => {
                const teamColor = leader.team === 'away' ? game.away.color : game.home.color;
                const teamName = leader.team === 'away' ? game.away.name : game.home.name;
                html += `
                    <div class="stat-row">
                        <span class="stat-label">${teamName} - ${leader.name}</span>
                        <span class="stat-value">${leader.value} ${leader.stat}</span>
                    </div>
                `;
            });
            
            leadersContainer.innerHTML = html;
        }
        
        function updateGameStats(game) {
            const statsContainer = document.getElementById('gameStats');
            if (!statsContainer) return;
            
            // Mock data for now - we'll extract this from ESPN API later
            const stats = [
                { label: 'Field Goal %', away: '48.5%', home: '52.1%' },
                { label: '3-Point %', away: '35.2%', home: '41.7%' },
                { label: 'Free Throw %', away: '78.9%', home: '82.4%' },
                { label: 'Total Rebounds', away: '42', home: '45' },
                { label: 'Assists', away: '23', home: '27' },
                { label: 'Turnovers', away: '11', home: '8' }
            ];
            
            let html = '';
            stats.forEach(stat => {
                html += `
                    <div class="stat-row">
                        <span class="stat-label">${stat.label}</span>
                        <span class="stat-value">${stat.away} - ${stat.home}</span>
                    </div>
                `;
            });
            
            statsContainer.innerHTML = html;
        }
        
        function updatePlayByPlay(game) {
            const playContainer = document.getElementById('playByPlay');
            if (!playContainer) return;
            
            // Mock data for now - we'll extract this from ESPN API later
            const plays = [
                { time: '7:31', text: 'Damian Lillard makes 3-point shot', score: '56-53' },
                { time: '7:45', text: 'Ja Morant makes driving layup', score: '56-51' },
                { time: '8:02', text: 'Jusuf Nurkiƒá defensive rebound', score: '54-51' },
                { time: '8:15', text: 'Anfernee Simons makes free throw 1 of 2', score: '54-51' },
                { time: '8:30', text: 'Timeout called by Portland', score: '54-50' }
            ];
            
            let html = '';
            plays.forEach(play => {
                html += `
                    <div class="play-item">
                        <div class="play-time">${play.time}</div>
                        <div class="play-text">${play.text}</div>
                        <div class="play-score">${play.score}</div>
                    </div>
                `;
            });
            
            playContainer.innerHTML = html;
        }

        function startLiveUpdates() {
            // Update every 10 seconds for live games
            console.log('üîÑ Starting live updates - will refresh every 10 seconds');
            updateInterval = setInterval(() => {
                console.log('üîÑ Refreshing live data at:', new Date().toLocaleTimeString());
                loadGameData();
            }, 10000);
        }

        function stopLiveUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        }

        // Load initial data
        loadGameData();
        
        function updateHeaderColors() {
            console.log('üé® updateHeaderColors() started!');
            
            const awayScore = document.getElementById('awayScore');
            const homeScore = document.getElementById('homeScore');
            console.log('üé® Found elements - awayScore:', awayScore, 'homeScore:', homeScore);
            
            const awayColor = awayScore ? awayScore.getAttribute('data-team-color') : '#333333';
            const homeColor = homeScore ? homeScore.getAttribute('data-team-color') : '#333333';
            
            console.log('üé® Header colors - Away:', awayColor, 'Home:', homeColor);
            
            const header = document.querySelector('.game-header');
            console.log('üé® Found header element:', header);
            
            if (header) {
                // Use home team color as primary (70%) with away as accent (30%)
                const gradient = `linear-gradient(135deg, ${awayColor}30 0%, ${homeColor} 100%)`;
                console.log('üé® Setting header gradient:', gradient);
                header.style.background = gradient;
                console.log('üé® Header style set to:', header.style.background);
            } else {
                console.error('‚ùå Header element not found!');
            }
            
            console.log('üé® updateHeaderColors() completed!');
        }
        
        function goToTeam(teamType) {
            // Get current game data from the last load
            const awayTeam = {
                id: document.getElementById('awayLogo').getAttribute('data-team-id') || '',
                name: document.getElementById('awayName').innerText,
                color: document.getElementById('awayLogo').getAttribute('data-team-color') || '#333333'
            };
            
            const homeTeam = {
                id: document.getElementById('homeLogo').getAttribute('data-team-id') || '',
                name: document.getElementById('homeName').innerText,
                color: document.getElementById('homeLogo').getAttribute('data-team-color') || '#333333'
            };
            
            const team = teamType === 'away' ? awayTeam : homeTeam;
            
            if (team.id) {
                location.href = `team.html?id=${team.id}&color=${encodeURIComponent(team.color)}&name=${encodeURIComponent(team.name)}`;
            }
        }

        // Clean up on page unload
        window.addEventListener('beforeunload', stopLiveUpdates);
    </script>
</body>
</html>
