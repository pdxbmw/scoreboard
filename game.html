<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Fredoka', sans-serif; background: #f8f9fa; margin: 0; padding: 0; }
        
        /* ESPN-inspired Header */
        .game-header {
            background: #333; color: white; padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1200px; margin: 0 auto; display: flex; justify-content: center; align-items: center;
            position: relative;
        }
        .back-btn { 
            background: rgba(255,255,255,0.2); color: white; border: none; 
            padding: 8px 16px; border-radius: 20px; font-weight: bold; cursor: pointer;
            text-decoration: none; font-size: 0.9rem; transition: background 0.3s;
            position: absolute; left: 0;
        }
        .back-btn:hover { background: rgba(255,255,255,0.3); }
        .game-title { font-size: 1.5rem; font-weight: 600; text-align: center; }
        .live-badge {
            background: #ff4444; color: white; padding: 4px 12px; 
            border-radius: 12px; font-size: 0.8rem; font-weight: bold;
            animation: pulse 2s infinite;
            position: absolute; right: 0;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        /* Main Container */
        .main-container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        
        /* Score Section */
        .score-section {
            background: white; border-radius: 12px; padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px;
        }
        .score-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #e8e8e8;
        }
        .game-info { font-size: 0.9rem; color: #666; }
        .status-display {
            background: #f0f0f0; padding: 8px 16px; border-radius: 20px; 
            font-weight: 600; font-size: 0.9rem;
        }
        .status-display.live { background: #ff4444; color: white; }
        .rank-badge { display: inline-block; background: transparent; color: #999; border-radius: 4px; padding: 0 2px; font-size: 0.7rem; font-weight: 500; margin-right: 2px; vertical-align: baseline; letter-spacing: 0; }
        
        .teams-score {
            display: grid; grid-template-columns: 1fr auto 1fr; gap: 30px; align-items: center;
        }
        .team-score-card {
            text-align: center; cursor: pointer; transition: transform 0.2s;
        }
        .team-score-card:hover { transform: translateY(-2px); }
        .team-label {
            font-size: 0.7rem; font-weight: bold; color: #666; 
            margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px;
        }
        .team-logo { width: 80px; height: 80px; margin-bottom: 10px; }
        .team-name { font-size: 1.1rem; font-weight: 600; margin-bottom: 5px; }
        .team-record { font-size: 0.8rem; color: #888; margin-bottom: 10px; }
        .team-score { 
            font-size: 2.5rem; 
            font-weight: bold; 
            color: #333; 
            line-height: 1;
            margin: 10px 0;
            white-space: nowrap;
        }
        .team-score.live { color: #000; }
        
        .score-divider {
            font-size: 1.5rem; font-weight: bold; color: #666;
        }
        
        /* Team Stats Side by Side */
        .team-stats-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;
        }
        .team-stats-section {
            display: flex; flex-direction: column; gap: 15px;
            --team-color: #e8e8e8;
        }
        .stats-card {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #f2f2f2;
            border-bottom: 3px solid var(--team-color);
        }
        .stats-header {
            font-size: 1.1rem; font-weight: 600; margin-bottom: 15px;
            padding-bottom: 10px; border-bottom: 1px solid #e8e8e8;
            display: flex; align-items: center; justify-content: space-between; gap: 8px;
        }
        .stats-header .stat-title { flex: 1; }
        .stats-header img {
            width: 20px; height: 20px; object-fit: contain; border-radius: 4px; background: #f4f4f4; padding: 2px;
        }
        .stat-row {
            display: flex; justify-content: space-between; padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-label { color: #666; font-size: 0.9rem; }
        .stat-value { font-weight: 600; font-size: 0.9rem; }
        
        /* Play by Play */
        .play-by-play {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .play-item {
            display: flex; align-items: center; padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .play-item:last-child { border-bottom: none; }
        .play-time {
            font-weight: 600; color: #666; width: 60px; font-size: 0.9rem;
        }
        .play-text { flex: 1; margin-left: 15px; font-size: 0.9rem; line-height: 1.4; }
        .play-score {
            font-weight: bold; color: #333; width: 50px; text-align: right;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .team-stats-container { grid-template-columns: 1fr; }
            .team-stats-section { gap: 12px; margin-bottom: 12px; }
            .teams-score { grid-template-columns: 1fr auto 1fr; gap: 16px; text-align: center; }
            .team-logo { width: 64px; height: 64px; }
            .team-score { font-size: 2.2rem; }
            .header-content { flex-direction: column; gap: 10px; }
            .back-btn { position: static; align-self: flex-start; }
            .live-badge { position: static; align-self: flex-end; }
        }
    </style>
</head>
<body>

    <div class="game-header">
        <div class="header-content">
            <a href="index.html" class="back-btn">‚Üê Back</a>
            <div class="game-title" id="gameTitle">Game Details</div>
            <div class="live-badge" id="liveIndicator" style="display: none;">LIVE</div>
        </div>
    </div>

    <div class="main-container">
        <!-- Score Section -->
        <div class="score-section">
            <div class="score-header">
                <div class="game-info">
                    <div id="gameLeague">NBA</div>
                    <div id="gameDate">Loading...</div>
                </div>
                <div class="status-display" id="gameStatus">
                    <span id="statusText">Loading...</span>
                </div>
            </div>
            
            <div class="teams-score">
                <div class="team-score-card" id="awayTeam" onclick="goToTeam('away')">
                    <div class="team-label">AWAY</div>
                    <img id="awayLogo" src="" alt="Away Team" class="team-logo">
                    <div class="team-name" id="awayName">Away Team</div>
                    <div class="team-record" id="awayRecord">0-0</div>
                    <div class="team-score" id="awayScore">0</div>
                </div>
                
                <div class="score-divider">@</div>
                
                <div class="team-score-card" id="homeTeam" onclick="goToTeam('home')">
                    <div class="team-label">HOME</div>
                    <img id="homeLogo" src="" alt="Home Team" class="team-logo">
                    <div class="team-name" id="homeName">Home Team</div>
                    <div class="team-record" id="homeRecord">0-0</div>
                    <div class="team-score" id="homeScore">0</div>
                </div>
            </div>
        </div>
        
        <!-- Team Stats Side by Side -->
        <div class="team-stats-container">
            <div class="team-stats-section">
                <div class="stats-card">
                    <div class="stats-header"><span class="stat-title">Team Leaders</span></div>
                    <div id="awayTeamLeaders">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header"><span class="stat-title">Game Statistics</span></div>
                    <div id="awayGameStats">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header"><span class="stat-title">Advanced Stats</span></div>
                    <div id="awayAdvancedStats">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header"><span class="stat-title">Team Stats</span></div>
                    <div id="awayTeamStats">Loading...</div>
                </div>
            </div>
            
            <div class="team-stats-section">
                <div class="stats-card">
                    <div class="stats-header"><span class="stat-title">Team Leaders</span></div>
                    <div id="homeTeamLeaders">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header"><span class="stat-title">Game Statistics</span></div>
                    <div id="homeGameStats">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header"><span class="stat-title">Advanced Stats</span></div>
                    <div id="homeAdvancedStats">Loading...</div>
                </div>
                <div class="stats-card">
                    <div class="stats-header"><span class="stat-title">Team Stats</span></div>
                    <div id="homeTeamStats">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Parse URL params
        const params = new URLSearchParams(window.location.search);
        const GAME_ID = params.get('id');
        const LEAGUE_KEY = params.get('league') || 'nba';
        const HOME_COLOR = decodeURIComponent(params.get('homeColor') || '#333333');
        const AWAY_COLOR = decodeURIComponent(params.get('awayColor') || '#333333');

        let updateInterval;
        let lastScores = { home: 0, away: 0 };

        const LEAGUE_ENDPOINTS = {
            nba: 'https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard',
            ncaa_mb: 'https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/scoreboard',
            ncaa_wb: 'https://site.api.espn.com/apis/site/v2/sports/basketball/womens-college-basketball/scoreboard'
        };
        const LEAGUE_SUMMARY = {
            nba: 'https://site.api.espn.com/apis/site/v2/sports/basketball/nba/summary?event=',
            ncaa_mb: 'https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/summary?event=',
            ncaa_wb: 'https://site.api.espn.com/apis/site/v2/sports/basketball/womens-college-basketball/summary?event='
        };

        const normalizeRank = (r) => {
            const n = Number(r);
            return Number.isFinite(n) && n > 0 && n <= 50 ? n : null;
        };

        function formatLocalDateTime(iso) {
            const d = new Date(iso);
            if (isNaN(d.getTime())) return null;
            return {
                date: d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' }),
                time: d.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })
            };
        }

        function isLiveStatus(status) {
            if (!status) return false;
            const s = status.toLowerCase();
            if (s.includes('in progress')) return true;
            if (s.includes('q1') || s.includes('q2') || s.includes('q3') || s.includes('q4')) return true;
            if (s.includes('half') || s.includes('ot')) return true;
            if (/\d+:\d+\s*-\s*\d+(st|nd|rd|th)/i.test(s)) return true;
            if (/\d+:\d+/.test(s) && !s.includes('am') && !s.includes('pm')) return true;
            return false;
        }

        async function loadGameData() {
            if (!GAME_ID) {
                document.getElementById('gameTitle').innerText = 'Game Not Found';
                return;
            }

            try {
                console.log('üîÑ Fetching detailed game data from ESPN API');
                let gameData = null;
                
                // First try summary endpoint for exact game
                try {
                    const summaryUrl = (LEAGUE_SUMMARY[LEAGUE_KEY] || LEAGUE_SUMMARY.nba) + GAME_ID;
                    console.log('Fetching summary URL:', summaryUrl);
                    const summaryRes = await fetch(summaryUrl);
                    if (summaryRes.ok) {
                        const summary = await summaryRes.json();
                        const comp = summary?.header?.competitions?.[0];
                        if (comp) {
                            const home = comp.competitors?.find(c => c.homeAway === 'home');
                            const away = comp.competitors?.find(c => c.homeAway === 'away');
                            const status = comp.status?.type?.shortDetail || comp.status?.type?.detail || '';
                            gameData = {
                                id: comp.id || GAME_ID,
                                league: summary?.header?.leagues?.[0]?.name || (LEAGUE_KEY === 'ncaa_mb' ? 'NCAA Men' : LEAGUE_KEY === 'ncaa_wb' ? 'NCAA Women' : 'NBA'),
                                league_key: LEAGUE_KEY,
                                sport: 'basketball',
                                league_slug: LEAGUE_KEY,
                                date: comp.date,
                                date_label: new Date(comp.date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' }),
                                status,
                                completed: comp.status?.type?.completed || false,
                                fullCompetition: comp,
                                away: {
                                    name: away?.team?.displayName,
                                    logo: away?.team?.logos?.[0]?.href || away?.team?.logo || '',
                                    color: AWAY_COLOR || "#" + (away?.team?.color || '333333'),
                                    record: away?.records?.[0]?.summary || '0-0',
                                    score: away?.score || '0',
                                    id: away?.team?.id,
                                    rank: normalizeRank(away?.curatedRank?.current || away?.rank)
                                },
                                home: {
                                    name: home?.team?.displayName,
                                    logo: home?.team?.logos?.[0]?.href || home?.team?.logo || '',
                                    color: HOME_COLOR || "#" + (home?.team?.color || '333333'),
                                    record: home?.records?.[0]?.summary || '0-0',
                                    score: home?.score || '0',
                                    id: home?.team?.id,
                                    rank: normalizeRank(home?.curatedRank?.current || home?.rank)
                                }
                            };
                            const local = formatLocalDateTime(comp.date);
                            if (local?.time) gameData.start_local = local.time;
                            console.log('‚úÖ Detailed game data fetched from summary API');
                        }
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è Summary fetch failed, will try scoreboard:', e);
                }

                // If summary didn't return, try to get data from ESPN scoreboard
                try {
                    const gameUrl = LEAGUE_ENDPOINTS[LEAGUE_KEY] || LEAGUE_ENDPOINTS.nba;
                    console.log('Fetching from URL:', gameUrl);
                    
                    const gameRes = await fetch(gameUrl);
                    const gameDataResponse = await gameRes.json();
                    
                    console.log('Game data response events count:', gameDataResponse.events?.length || 0);
                    console.log('Looking for game ID:', GAME_ID, 'league:', LEAGUE_KEY);
                    
                    // Find our game in the data
                    for (const event of gameDataResponse.events) {
                        if (event.id === GAME_ID) {
                            const comp = event.competitions?.[0];
                            if (!comp) continue;
                            const status = comp.status?.type?.shortDetail || comp.status?.type?.detail || '';
                            const home = comp.competitors?.find(c => c.homeAway === 'home') || comp.competitors?.[0];
                            const away = comp.competitors?.find(c => c.homeAway === 'away') || comp.competitors?.[1];
                            if (!home || !away) continue;
                            
                            gameData = {
                                id: event.id,
                                league: event.leagues?.[0]?.name || (LEAGUE_KEY === 'ncaa_mb' ? 'NCAA Men' : LEAGUE_KEY === 'ncaa_wb' ? 'NCAA Women' : 'NBA'),
                                league_key: LEAGUE_KEY,
                                sport: 'basketball',
                                league_slug: LEAGUE_KEY,
                                date_label: new Date(event.date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' }),
                                status: status,
                                completed: comp.status?.type?.completed || false,
                                fullCompetition: comp,
                                away: {
                                    name: away.team?.displayName,
                                    logo: away.team?.logos?.[0]?.href || away.team?.logo || '',
                                    color: AWAY_COLOR || "#" + (away.team?.color || '333333'),
                                    record: away.records?.[0]?.summary || '0-0',
                                    score: away.score || '0',
                                    id: away.team?.id,
                                    rank: normalizeRank(away.curatedRank?.current || away.rank)
                                },
                                home: {
                                    name: home.team?.displayName,
                                    logo: home.team?.logos?.[0]?.href || home.team?.logo || '',
                                    color: HOME_COLOR || "#" + (home.team?.color || '333333'),
                                    record: home.records?.[0]?.summary || '0-0',
                                    score: home.score || '0',
                                    id: home.team?.id,
                                    rank: normalizeRank(home.curatedRank?.current || home.rank)
                                }
                            };
                            const local = formatLocalDateTime(event.date);
                            if (local?.time) gameData.start_local = local.time;
                            console.log('‚úÖ Detailed game data fetched from ESPN API');
                            break;
                        }
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è ESPN API failed, trying scraped data:', e);
                }
                
                // If ESPN didn't have the game, try to get it from scraped data
                if (!gameData) {
                    console.log('üîÑ Game not found in ESPN API, trying scraped data');
                    try {
                        const scrapedRes = await fetch('data/scores.json');
                        const scrapedData = await scrapedRes.json();
                        
                        // Search through all dates in scraped data
                        for (const dateKey in scrapedData) {
                            const games = scrapedData[dateKey];
                            if (Array.isArray(games)) {
                                const foundGame = games.find(g => g.id === GAME_ID);
                                if (foundGame) {
                                    console.log('‚úÖ Found game in scraped data:', foundGame);
                                    gameData = {
                                        ...foundGame,
                                        league: foundGame.league || 'NBA',
                                        date_label: foundGame.date_label || new Date(foundGame.date || Date.now()).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' })
                                    };
                                    const local = formatLocalDateTime(foundGame.date);
                                    if (local?.time) gameData.start_local = local.time;
                                    break;
                                }
                            }
                        }
                    } catch (e) {
                        console.log('‚ö†Ô∏è Could not load scraped data:', e);
                    }
                }

                if (gameData) {
                    // Check if scores changed
                    const currentHomeScore = parseInt(gameData.home.score);
                    const currentAwayScore = parseInt(gameData.away.score);
                    
                    if (lastScores.home !== currentHomeScore || lastScores.away !== currentAwayScore) {
                        console.log(`üìä SCORES CHANGED: ${lastScores.away}-${lastScores.home} ‚Üí ${currentAwayScore}-${currentHomeScore}`);
                        lastScores = { home: currentHomeScore, away: currentAwayScore };
                    } else {
                        console.log(`üìä Scores unchanged: ${currentAwayScore}-${currentHomeScore}`);
                    }
                    
                    updateGameDisplay(gameData);
                    
                    // Set up live updates only for live ESPN games
                    const isLiveGame = isLiveStatus(gameData.status);
                    
                    if (isLiveGame) {
                        startLiveUpdates();
                    } else {
                        stopLiveUpdates();
                    }
                } else {
                    document.getElementById('gameTitle').innerText = 'Game Not Found';
                }
            } catch (e) {
                console.error('Error loading game:', e);
                document.getElementById('gameTitle').innerText = 'Error Loading Game';
            }
        }

        function updateGameDisplay(game) {
            console.log('üé® updateGameDisplay called with game:', game);
            
            // Check if all required elements exist
            const requiredElements = [
                'gameTitle', 'gameLeague', 'gameDate', 'awayLogo', 'awayName', 
                'awayRecord', 'awayScore', 'homeLogo', 'homeName', 'homeRecord', 'homeScore',
                'gameStatus', 'statusText', 'liveIndicator'
            ];
            
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`üîç Element ${id}:`, element ? '‚úÖ Found' : '‚ùå Missing');
            });
            
            // Update header
            const gameTitle = document.getElementById('gameTitle');
            const gameLeague = document.getElementById('gameLeague');
            const gameDate = document.getElementById('gameDate');
            if (gameTitle) gameTitle.innerText = `${game.away.name} @ ${game.home.name}`;
            if (gameLeague) gameLeague.innerText = game.league || 'NBA';
            const localDT = formatLocalDateTime(game.date);
            if (gameDate) gameDate.innerText = (localDT && localDT.date) || game.date_label || new Date().toDateString();
            
            // Update team information
            const awayLogo = document.getElementById('awayLogo');
            const homeLogo = document.getElementById('homeLogo');
            const awayName = document.getElementById('awayName');
            const homeName = document.getElementById('homeName');
            const awayRecord = document.getElementById('awayRecord');
            const homeRecord = document.getElementById('homeRecord');
            const awayScore = document.getElementById('awayScore');
            const homeScore = document.getElementById('homeScore');
            
            if (awayLogo) {
                awayLogo.src = game.away.logo;
                awayLogo.setAttribute('data-team-id', game.away.id);
                awayLogo.setAttribute('data-team-color', AWAY_COLOR);
                console.log('üî¥ Away team:', game.away.name, 'Color:', AWAY_COLOR);
            }
            const awayRank = normalizeRank(game.away?.rank);
            const homeRank = normalizeRank(game.home?.rank);

            if (awayName) awayName.innerHTML = `${awayRank ? `<span class="rank-badge">#${awayRank}</span>` : ''}${game.away.name}`;
            if (awayRecord) awayRecord.innerText = game.away.record;
            if (awayScore) {
                awayScore.innerText = game.away.score;
                console.log('üî¥ Set away score to:', game.away.score);
            } else {
                console.error('‚ùå Away score element not found!');
            }
            
            if (homeLogo) {
                homeLogo.src = game.home.logo;
                homeLogo.setAttribute('data-team-id', game.home.id);
                homeLogo.setAttribute('data-team-color', HOME_COLOR);
                console.log('üî¥ Home team:', game.home.name, 'Color:', HOME_COLOR);
            }
            if (homeName) homeName.innerHTML = `${homeRank ? `<span class="rank-badge">#${homeRank}</span>` : ''}${game.home.name}`;
            if (homeRecord) homeRecord.innerText = game.home.record;
            if (homeScore) {
                homeScore.innerText = game.home.score;
                console.log('üî¥ Set home score to:', game.home.score);
            } else {
                console.error('‚ùå Home score element not found!');
            }
            
            // Update status
            const statusEl = document.getElementById('gameStatus');
            const statusText = document.getElementById('statusText');
            const liveIndicator = document.getElementById('liveIndicator');
            
            // Only apply live styling for actually live games
            const isLiveGame = !game.completed && isLiveStatus(game.status);
            
            // Format status with red time for live games
            let displayStatus = game.status;
            if (isLiveGame && /\d+:\d+\s*-\s*\d+(st|nd|rd|th)/.test(game.status)) {
                const timeMatch = game.status.match(/(\d+:\d+)/);
                const quarterNum = game.status.match(/(\d+)(?:st|nd|rd|th)/);
                if (timeMatch && quarterNum) {
                    displayStatus = `Q${quarterNum[1]} <span class="live-text white">${timeMatch[1]}</span>`;
                }
            }
            
            console.log('Game status:', game.status);
            console.log('Is completed:', game.completed);
            console.log('Is live game:', isLiveGame);
            
            if (statusText) statusText.innerHTML = displayStatus;
            
            if (isLiveGame) {
                if (statusEl) statusEl.className = 'status-display live';
                if (liveIndicator) liveIndicator.style.display = 'block';
                if (awayScore) awayScore.classList.add('live');
                if (homeScore) homeScore.classList.add('live');
                console.log('üî¥ Game is LIVE - showing live indicator');
            } else if (game.completed) {
                if (statusEl) statusEl.className = 'status-display';
                if (liveIndicator) liveIndicator.style.display = 'none';
                if (awayScore) awayScore.classList.remove('live');
                if (homeScore) homeScore.classList.remove('live');
                console.log('Game is completed');
            } else {
                // Scheduled: show local time only (strip source tz/date strings)
                const localTime = (localDT && localDT.time) || game.start_local;
                if (localTime) {
                    displayStatus = localTime;
                } else {
                    const timeOnly = (game.status || '').match(/(\d{1,2}:\d{2}\s*[AP]M)/i);
                    displayStatus = timeOnly ? timeOnly[1].replace(/\s+/g,' ').trim() : game.status;
                }

                if (statusEl) statusEl.className = 'status-display';
                if (statusText) statusText.innerHTML = displayStatus;
                if (liveIndicator) liveIndicator.style.display = 'none';
                if (awayScore) awayScore.classList.remove('live');
                if (homeScore) homeScore.classList.remove('live');
                console.log('Game is scheduled');
            }
            
            // Update all team-specific stats sections
            updateAwayTeamLeaders(game);
            updateHomeTeamLeaders(game);
            updateAwayGameStats(game);
            updateHomeGameStats(game);
            updateAwayAdvancedStats(game);
            updateHomeAdvancedStats(game);
            updateAwayTeamStats(game);
            updateHomeTeamStats(game);
            
            // Update header colors with team colors
            console.log('üé® About to call updateHeaderColors()...');
            updateHeaderColors();
            console.log('üé® updateHeaderColors() call completed!');
        }

        function setHeaderLogo(containerId, logo, title) {
            const statsContainer = document.getElementById(containerId);
            if (!statsContainer) return;
            const header = statsContainer.previousElementSibling;
            if (header && header.classList.contains('stats-header')) {
                header.innerHTML = `<span class="stat-title">${title}</span><img src="${logo}" alt="${title}">`;
            }
        }

        function setCardColor(containerId, color) {
            const statsContainer = document.getElementById(containerId);
            if (!statsContainer) return;
            const card = statsContainer.parentElement;
            if (card && card.classList.contains('stats-card')) {
                card.style.setProperty('--team-color', color || '#e8e8e8');
            }
        }
        
        function updateAwayTeamLeaders(game) {
            const leadersContainer = document.getElementById('awayTeamLeaders');
            if (!leadersContainer) return;
            setHeaderLogo('awayTeamLeaders', game.away.logo, 'Team Leaders');
            setCardColor('awayTeamLeaders', game.away.color);
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const awayCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'away');
                
                if (awayCompetitor && awayCompetitor.leaders) {
                    let html = '';
                    awayCompetitor.leaders.forEach(leaderCategory => {
                        if (leaderCategory.leaders && leaderCategory.leaders.length > 0) {
                            const leader = leaderCategory.leaders[0];
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${leader.athlete?.displayName || 'Unknown'}</span>
                                    <span class="stat-value">${leader.displayValue} ${leaderCategory.displayName}</span>
                                </div>
                            `;
                        }
                    });
                    
                    leadersContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
                } else {
                    leadersContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
                }
            } else {
                leadersContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
            }
        }
        
        function updateHomeTeamLeaders(game) {
            const leadersContainer = document.getElementById('homeTeamLeaders');
            if (!leadersContainer) return;
            setHeaderLogo('homeTeamLeaders', game.home.logo, 'Team Leaders');
            setCardColor('homeTeamLeaders', game.home.color);
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const homeCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'home');
                
                if (homeCompetitor && homeCompetitor.leaders) {
                    let html = '';
                    homeCompetitor.leaders.forEach(leaderCategory => {
                        if (leaderCategory.leaders && leaderCategory.leaders.length > 0) {
                            const leader = leaderCategory.leaders[0];
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${leader.athlete?.displayName || 'Unknown'}</span>
                                    <span class="stat-value">${leader.displayValue} ${leaderCategory.displayName}</span>
                                </div>
                            `;
                        }
                    });
                    
                    leadersContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
                } else {
                    leadersContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
                }
            } else {
                leadersContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Leaders not available</span></div>';
            }
        }
        
        function updateAwayGameStats(game) {
            const statsContainer = document.getElementById('awayGameStats');
            if (!statsContainer) return;
            setHeaderLogo('awayGameStats', game.away.logo, 'Game Statistics');
            setCardColor('awayGameStats', game.away.color);
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const awayCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'away');
                
                if (awayCompetitor && awayCompetitor.statistics) {
                    let html = '';
                    const keyStats = ['fieldGoalPct', 'threePointPct', 'freeThrowPct', 'rebounds', 'assists'];
                    
                    keyStats.forEach(statName => {
                        const stat = awayCompetitor.statistics.find(s => s.name === statName);
                        if (stat) {
                            let label = statName;
                            if (statName === 'fieldGoalPct') label = 'Field Goal %';
                            else if (statName === 'threePointPct') label = '3-Point %';
                            else if (statName === 'freeThrowPct') label = 'Free Throw %';
                            else if (statName === 'rebounds') label = 'Total Rebounds';
                            else if (statName === 'assists') label = 'Assists';
                            
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${label}</span>
                                    <span class="stat-value">${stat.displayValue}</span>
                                </div>
                            `;
                        }
                    });
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
            }
        }
        
        function updateHomeGameStats(game) {
            const statsContainer = document.getElementById('homeGameStats');
            if (!statsContainer) return;
            setHeaderLogo('homeGameStats', game.home.logo, 'Game Statistics');
            setCardColor('homeGameStats', game.home.color);
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const homeCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'home');
                
                if (homeCompetitor && homeCompetitor.statistics) {
                    let html = '';
                    const keyStats = ['fieldGoalPct', 'threePointPct', 'freeThrowPct', 'rebounds', 'assists'];
                    
                    keyStats.forEach(statName => {
                        const stat = homeCompetitor.statistics.find(s => s.name === statName);
                        if (stat) {
                            let label = statName;
                            if (statName === 'fieldGoalPct') label = 'Field Goal %';
                            else if (statName === 'threePointPct') label = '3-Point %';
                            else if (statName === 'freeThrowPct') label = 'Free Throw %';
                            else if (statName === 'rebounds') label = 'Total Rebounds';
                            else if (statName === 'assists') label = 'Assists';
                            
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${label}</span>
                                    <span class="stat-value">${stat.displayValue}</span>
                                </div>
                            `;
                        }
                    });
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Stats not available</span></div>';
            }
        }
        
        function updateAwayAdvancedStats(game) {
            const statsContainer = document.getElementById('awayAdvancedStats');
            if (!statsContainer) return;
            setHeaderLogo('awayAdvancedStats', game.away.logo, 'Advanced Stats');
            setCardColor('awayAdvancedStats', game.away.color);
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const awayCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'away');
                
                if (awayCompetitor && awayCompetitor.statistics) {
                    let html = '';
                    const advancedStats = ['fieldGoalsAttempted', 'fieldGoalsMade', 'threePointFieldGoalsAttempted', 'threePointFieldGoalsMade', 'freeThrowsAttempted', 'freeThrowsMade'];
                    
                    advancedStats.forEach(statName => {
                        const stat = awayCompetitor.statistics.find(s => s.name === statName);
                        if (stat) {
                            let label = statName;
                            if (statName === 'fieldGoalsAttempted') label = 'FG Attempts';
                            else if (statName === 'fieldGoalsMade') label = 'FG Made';
                            else if (statName === 'threePointFieldGoalsAttempted') label = '3PT Attempts';
                            else if (statName === 'threePointFieldGoalsMade') label = '3PT Made';
                            else if (statName === 'freeThrowsAttempted') label = 'FT Attempts';
                            else if (statName === 'freeThrowsMade') label = 'FT Made';
                            
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${label}</span>
                                    <span class="stat-value">${stat.displayValue}</span>
                                </div>
                            `;
                        }
                    });
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
            }
        }
        
        function updateHomeAdvancedStats(game) {
            const statsContainer = document.getElementById('homeAdvancedStats');
            if (!statsContainer) return;
            setHeaderLogo('homeAdvancedStats', game.home.logo, 'Advanced Stats');
            setCardColor('homeAdvancedStats', game.home.color);
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const homeCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'home');
                
                if (homeCompetitor && homeCompetitor.statistics) {
                    let html = '';
                    const advancedStats = ['fieldGoalsAttempted', 'fieldGoalsMade', 'threePointFieldGoalsAttempted', 'threePointFieldGoalsMade', 'freeThrowsAttempted', 'freeThrowsMade'];
                    
                    advancedStats.forEach(statName => {
                        const stat = homeCompetitor.statistics.find(s => s.name === statName);
                        if (stat) {
                            let label = statName;
                            if (statName === 'fieldGoalsAttempted') label = 'FG Attempts';
                            else if (statName === 'fieldGoalsMade') label = 'FG Made';
                            else if (statName === 'threePointFieldGoalsAttempted') label = '3PT Attempts';
                            else if (statName === 'threePointFieldGoalsMade') label = '3PT Made';
                            else if (statName === 'freeThrowsAttempted') label = 'FT Attempts';
                            else if (statName === 'freeThrowsMade') label = 'FT Made';
                            
                            html += `
                                <div class="stat-row">
                                    <span class="stat-label">${label}</span>
                                    <span class="stat-value">${stat.displayValue}</span>
                                </div>
                            `;
                        }
                    });
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Advanced stats not available</span></div>';
            }
        }
        
        function updateAwayTeamStats(game) {
            const statsContainer = document.getElementById('awayTeamStats');
            if (!statsContainer) return;
            setHeaderLogo('awayTeamStats', game.away.logo, 'Team Stats');
            setCardColor('awayTeamStats', game.away.color);
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const awayCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'away');
                
                if (awayCompetitor) {
                    let html = '';
                    
                    // Add team record
                    if (awayCompetitor.records && awayCompetitor.records.length > 0) {
                        html += `
                            <div class="stat-row">
                                <span class="stat-label">Record</span>
                                <span class="stat-value">${awayCompetitor.records[0].summary}</span>
                            </div>
                        `;
                    }
                    
                    // Add quarter scores
                    if (awayCompetitor.linescores && awayCompetitor.linescores.length > 0) {
                        const quarterScores = awayCompetitor.linescores.map(s => s.displayValue).join(', ');
                        html += `
                            <div class="stat-row">
                                <span class="stat-label">Quarter Scores</span>
                                <span class="stat-value">${quarterScores}</span>
                            </div>
                        `;
                    }
                    
                    // Add winner indicator
                    html += `
                        <div class="stat-row">
                            <span class="stat-label">Winner</span>
                            <span class="stat-value">${awayCompetitor.winner ? '‚úì' : ''}</span>
                        </div>
                    `;
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
            }
        }
        
        function updateHomeTeamStats(game) {
            const statsContainer = document.getElementById('homeTeamStats');
            if (!statsContainer) return;
            setHeaderLogo('homeTeamStats', game.home.logo, 'Team Stats');
            setCardColor('homeTeamStats', game.home.color);
            
            // Use real ESPN data from fullCompetition
            if (game.fullCompetition && game.fullCompetition.competitors) {
                const homeCompetitor = game.fullCompetition.competitors.find(c => c.homeAway === 'home');
                
                if (homeCompetitor) {
                    let html = '';
                    
                    // Add team record
                    if (homeCompetitor.records && homeCompetitor.records.length > 0) {
                        html += `
                            <div class="stat-row">
                                <span class="stat-label">Record</span>
                                <span class="stat-value">${homeCompetitor.records[0].summary}</span>
                            </div>
                        `;
                    }
                    
                    // Add quarter scores
                    if (homeCompetitor.linescores && homeCompetitor.linescores.length > 0) {
                        const quarterScores = homeCompetitor.linescores.map(s => s.displayValue).join(', ');
                        html += `
                            <div class="stat-row">
                                <span class="stat-label">Quarter Scores</span>
                                <span class="stat-value">${quarterScores}</span>
                            </div>
                        `;
                    }
                    
                    // Add winner indicator
                    html += `
                        <div class="stat-row">
                            <span class="stat-label">Winner</span>
                            <span class="stat-value">${homeCompetitor.winner ? '‚úì' : ''}</span>
                        </div>
                    `;
                    
                    statsContainer.innerHTML = html || '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
                } else {
                    statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
                }
            } else {
                statsContainer.innerHTML = '<div class="stat-row"><span class="stat-label">Team stats not available</span></div>';
            }
        }

        function startLiveUpdates() {
            if (updateInterval) clearInterval(updateInterval);
            console.log('üîÑ Starting live updates - will refresh every 10 seconds');
            updateInterval = setInterval(() => {
                console.log('üîÑ Refreshing live data at:', new Date().toLocaleTimeString());
                loadGameData();
            }, 10000);
        }

        function stopLiveUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        }

        // Load initial data
        loadGameData();
        
        function updateHeaderColors() {
            console.log('üé® updateHeaderColors() started!');
            
            const awayScore = document.getElementById('awayScore');
            const homeScore = document.getElementById('homeScore');
            console.log('üé® Found elements - awayScore:', awayScore, 'homeScore:', homeScore);
            
            const awayColor = awayScore ? awayScore.getAttribute('data-team-color') : '#333333';
            const homeColor = homeScore ? homeScore.getAttribute('data-team-color') : '#333333';
            
            console.log('üé® Header colors - Away:', awayColor, 'Home:', homeColor);
            
            const header = document.querySelector('.game-header');
            console.log('üé® Found header element:', header);
            
            if (header) {
                // Use home team color as primary (70%) with away as accent (30%)
                const gradient = `linear-gradient(135deg, ${awayColor}30 0%, ${homeColor} 100%)`;
                console.log('üé® Setting header gradient:', gradient);
                header.style.background = gradient;
                console.log('üé® Header style set to:', header.style.background);
            } else {
                console.error('‚ùå Header element not found!');
            }
            
            console.log('üé® updateHeaderColors() completed!');
        }
        
        function goToTeam(teamType) {
            // Get current game data from the last load
            const awayTeam = {
                id: document.getElementById('awayLogo').getAttribute('data-team-id') || '',
                name: document.getElementById('awayName').innerText,
                color: document.getElementById('awayLogo').getAttribute('data-team-color') || '#333333'
            };
            
            const homeTeam = {
                id: document.getElementById('homeLogo').getAttribute('data-team-id') || '',
                name: document.getElementById('homeName').innerText,
                color: document.getElementById('homeLogo').getAttribute('data-team-color') || '#333333'
            };
            
            const team = teamType === 'away' ? awayTeam : homeTeam;
            
            if (team.id) {
                location.href = `team.html?id=${team.id}&color=${encodeURIComponent(team.color)}&name=${encodeURIComponent(team.name)}`;
            }
        }

        // Clean up on page unload
        window.addEventListener('beforeunload', stopLiveUpdates);
    </script>
</body>
</html>
